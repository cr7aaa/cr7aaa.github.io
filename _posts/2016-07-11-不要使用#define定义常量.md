---
layout: post
title:  "不要使用#define定义常量"
date:   2016-07-11 18:27:37
categories: tips
---


在日常开发中经常需要定义常量.比如执行某段动画需要把动画时长定义为某个常量,通常会有人这么定义:

```
 #define duration 10
```
上述代码会在编译前将工程中所有的duration字符串替换为 10,这可能是你想要看到的结果,但是这样定义的常量没有类型信息,而且如果在声明文件中定义了此常量,那么所有引用了此头文件的代码中所有的duration字符串都替换为了10.

要解决这个问题,有个方法比预处理指令更好

```
static const NSTimeInterval kDuration = 10;
```

此方法定义的常量包含了常量的类型信息.在命名方面,若常量局限于某个编译单元内,则在前面加字母k;若常量在此类之外可见,则通常以类名为前缀.

### 定义常量的位置
定义常量的位置很重要,我们通常喜欢在头文件中声明预处理指令,这样的话当别的文件引用了改头文件,如果改文件中也有改常量名,就会被覆盖.就算用static const定义常量也不应该出现在头文件中.这样就相当于声明了一个叫duration的全局变量.此名称通常需要加上类前缀,比方说可以这么定义PersonDuration.

### 定义在实现文件中

```
#import "Person.h"

static const NSTimeInterval kDuration = 10;
@implementation Person

@end

```

变量一定要同时用const和static修饰.如果用const修饰的变量被修改了,那么编译器就会报错,这正是我们想要的结果.用static修饰表示改变量只在定义变量的文件中有效,如果不加static修饰,编译器会为它创建一个“外部符号”,当别的文件也定义了同名的变量,就会报duplicate symbol _kDuration in:这个错误信息.

用这种方式定义的变量和用预处理指令一样,把所有遇到的变量都替换为改常量值.但与之不同的是会带上类型信息.


### 定义在声明文件中

有时候需要对外公开某个常量,例如发送通知,通常需要讲通知名称定义在声明文件中,供全局的文件使用.

```
//.h 中
extern NSString * const PersonNotification;

//.m 中
NSString * const PersonNotification = @"personNotification";
```
这个常量在头文件中声明,在实现文件中定义.注意const修饰符在常量类型中的位置.常量定义从右向左解读,所以本例中PersonNotification就是一个常量,而这个常量是一个只向NSString对象的指针.所以不能改变此指针常量.

### 总结
要点:

- 不要用预处理指令定义常量.这样定义出来的常量不含类型信息,编译器只会在编译前根据次指令替换常量.即使有人重现定义了常量值,编译器也不会发出警告.

- 在实现文件中使用 static const定义常量,定义“只在编译单元内可见的常量”。常量名无需加类前缀。

- 在头文件中使用extern声明全局常量,并在实现文件中定义其值.常量名需加类前缀.